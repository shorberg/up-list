<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Reliable Superstore BDC Online Up List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    :root{
      --bg:#f6f8fb; --card:#fff; --ink:#111; --muted:#5a6b7b; --ok:#1f9d55; --bad:#d64545;
      --line:#e6e9ef; --accent:#2f67ff; --row:#f0f5ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:22px;margin:0}
    .sub{color:var(--muted);font-size:13px}
    .clock{font-weight:600}
    .bar{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap}
    input[type=text]{height:36px;padding:0 10px;border:1px solid var(--line);border-radius:8px;background:#fff;min-width:220px}
    button{height:36px;padding:0 12px;border:1px solid var(--line);border-radius:8px;background:#fff;cursor:pointer}
    button.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    button.warn{background:#fff3f3;border-color:#ffd4d4;color:#c92a2a}
    button.small{height:30px;font-size:12px;padding:0 10px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden}
    table{width:100%;border-collapse:collapse}
    thead th{background:#0f172a;color:#fff;font-weight:600;padding:10px;font-size:13px;text-align:left}
    tbody td{border-top:1px solid var(--line);padding:8px;vertical-align:middle}
    tr.up{background:var(--row)}
    .tag{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line);background:#fff}
    .tag.ok{color:var(--ok);border-color:#b8eecf;background:#edfff5}
    .tag.bad{color:#c92a2a;border-color:#ffd4d4;background:#fff5f5}
    .footer{margin-top:18px;display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:10px}
    .link{display:flex;gap:10px;align-items:center;justify-content:center;background:#fff;border:1px solid var(--line);border-radius:10px;height:48px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Reliable Superstore BDC Online Up List</h1>
        <div class="sub"><span id="today"></span> â€¢ <span class="clock" id="clock"></span></div>
      </div>
    </header>

    <div class="bar">
      <input id="nameInput" type="text" placeholder="Add team member name" />
      <button class="primary" id="addBtn">Add</button>
      <button id="nextBtn">Next Lead</button>
      <button id="resetBtn">Reset</button>
      <button id="newDayBtn">New Day</button>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th style="width:44px">Order</th>
            <th style="width:220px">Name</th>
            <th style="width:90px">Status</th>
            <th style="width:80px">Leads</th>
            <th style="width:95px">Last Lead</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

<script>
  // === CONFIG ===
  const SUPABASE_URL = "https://imfzlhudhljathvkgkqf.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltZnpsaHVkaGxqYXRodmtna3FmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4MDAxMDUsImV4cCI6MjA3MzM3NjEwNX0.Bb-SUJMWfzVMHkdYuAgAD31wExcLuNazss6AJ11Z_VQ";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const tbody = document.getElementById('tbody');
  const nameInput = document.getElementById('nameInput');

  // Clock
  function tick(){
    const d = new Date();
    document.getElementById('today').textContent = d.toLocaleDateString(undefined, { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    document.getElementById('clock').textContent = d.toLocaleTimeString(undefined,{ hour:'numeric', minute:'2-digit', second:'2-digit' });
  }
  setInterval(tick, 1000); tick();

  // Fetch people
  async function fetchPeople(){
    const { data, error } = await supabase.from('people').select('*').order('order', { ascending:true });
    if(error){ console.error(error); return []; }
    return data;
  }

  // Render people
  async function render(){
    const rows = await fetchPeople();
    tbody.innerHTML = '';
    rows.forEach((p,i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${p.name}</td>
        <td><span class="tag ${p.is_up ? 'ok' : 'bad'}">${p.is_up ? 'Up' : 'Waiting'}</span></td>
        <td>${p.leads || 0}</td>
        <td>${p.last_served || ''}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Add person
  async function addPerson(){
    const name = nameInput.value.trim();
    if(!name) return;
    const rows = await fetchPeople();
    const nextOrder = rows.length ? Math.max(...rows.map(r=>r.order))+1 : 1;

    await supabase.from('people').insert([{ 
      name, 
      status: 'Here', 
      is_up: false, 
      order: nextOrder, 
      leads: 0 
    }]);
    nameInput.value = '';
    render();
  }

  // Button bindings
  document.getElementById('addBtn').onclick = addPerson;
  document.getElementById('resetBtn').onclick = async () => {
    await supabase.from('people').update({ is_up:false, leads:0 }).neq('id', null);
    render();
  };

  // Auto-refresh with Supabase realtime
  supabase.channel('any')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'people' }, payload => {
      console.log("Change received:", payload);
      render();
    })
    .subscribe();

  // Initial render
  render();
</script>
</body>
</html>