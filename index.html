<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Reliable Superstore BDC Online Up List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --bg:#f6f8fb; --card:#fff; --ink:#111; --muted:#5a6b7b; --ok:#1f9d55; --bad:#d64545;
      --line:#e6e9ef; --accent:#2f67ff; --row:#f0f5ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:22px;margin:0}
    .sub{color:var(--muted);font-size:13px}
    .clock{font-weight:600}
    .bar{display:flex;gap:8px;margin:12px 0}
    input[type=text]{height:36px;padding:0 10px;border:1px solid var(--line);border-radius:8px;background:#fff;min-width:260px}
    button{height:36px;padding:0 12px;border:1px solid var(--line);border-radius:8px;background:#fff;cursor:pointer}
    button.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden}
    table{width:100%;border-collapse:collapse}
    thead th{background:#0f172a;color:#fff;font-weight:600;padding:10px;font-size:13px;text-align:left}
    tbody td{border-top:1px solid var(--line);padding:8px;vertical-align:middle;text-align:center}
    tr.up{background:var(--row)}
    .x{font-weight:700;font-size:18px}
    .blackx{color:#000}
    .redx{color:#d64545}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Reliable Superstore BDC Online Up List</h1>
        <div class="sub"><span id="today"></span> â€¢ <span class="clock" id="clock"></span></div>
      </div>
    </header>

    <div class="bar">
      <input id="nameInput" type="text" placeholder="Add team member name" />
      <button class="primary" id="addBtn">Add</button>
      <button id="nextBtn">Next Lead</button>
      <button id="resetBtn">Reset</button>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th style="width:44px">Order</th>
            <th style="width:220px">Name</th>
            <th style="width:90px">Status</th>
            <th style="width:50px">Up</th>
            <th style="width:80px">Makeups</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

<script>
  // === CONFIG ===
  const SUPABASE_URL = "https://imfzlhudhljathvkgkqf.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltZnpsaHVkaGxqYXRodmtna3FmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4MDAxMDUsImV4cCI6MjA3MzM3NjEwNX0.Bb-SUJMWfzVMHkdYuAgAD31wExcLuNazss6AJ11Z_VQ";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const el = (id) => document.getElementById(id);
  const tbody = el('tbody');
  const nameInput = el('nameInput');

  // Header clock
  function tick(){
    const d = new Date();
    el('today').textContent = d.toLocaleDateString(undefined, { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    el('clock').textContent = d.toLocaleTimeString(undefined,{ hour:'numeric', minute:'2-digit', second:'2-digit' });
  }
  setInterval(tick, 1000); tick();

  // ------- CRUD -------
  async function fetchPeople(){
    const { data, error } = await supabase
      .from('people').select('*')
      .order('order', { ascending:true });
    if(error){ console.error(error); return []; }
    render(data);
    return data;
  }

  async function addPerson(){
    const name = nameInput.value.trim();
    if(!name) return;
    const fixed = name.toLowerCase().replace(/\b\w/g, m => m.toUpperCase());

    const rows = await fetchPeople();
    const nextOrder = rows.length ? Math.max(...rows.map(r=>r.order))+1 : 1;

    await supabase.from('people').insert({ name: fixed, status: "Here", order: nextOrder, is_up:false, makeups:0 });
    nameInput.value = "";
    fetchPeople();
  }

  async function nextLead(){
    const { data: rows, error } = await supabase
      .from('people').select('*')
      .order('order', { ascending:true });
    if(error || !rows.length) return;

    let currentIndex = rows.findIndex(r => r.is_up);

    await supabase.from('people').update({ is_up: false }).neq('id','');

    let nextIndex = currentIndex + 1;
    if(nextIndex >= rows.length) nextIndex = 0;

    await supabase.from('people').update({ is_up:true }).eq('id', rows[nextIndex].id);
    fetchPeople();
  }

  async function resetList(){
    await supabase.from('people').update({ is_up:false, order:0, leads:0, makeups:0 });
    fetchPeople();
  }

  // ------- RENDER -------
  function render(rows){
    tbody.innerHTML = "";
    rows.forEach(p=>{
      const tr = document.createElement("tr");
      if(p.is_up) tr.classList.add("up");
      tr.innerHTML = `
        <td>${p.order}</td>
        <td>${p.name}</td>
        <td>${p.status}</td>
        <td>${p.is_up ? '<span class="x blackx">X</span>' : ''}</td>
        <td>${p.makeups > 0 ? '<span class="x redx">X</span>' : ''}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // ------- EVENTS -------
  el('addBtn').onclick = addPerson;
  el('nextBtn').onclick = nextLead;
  el('resetBtn').onclick = resetList;

  fetchPeople();
</script>
</body>
</html>
