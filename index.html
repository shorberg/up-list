<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Reliable Superstore BDC Online Up List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f6f8fb; margin:0; padding:20px; }
    h1 { margin:0; }
    .bar { margin:12px 0; display:flex; gap:8px; }
    input { padding:6px; }
    button { padding:6px 10px; cursor:pointer; }
    table { width:100%; border-collapse:collapse; margin-top:16px; background:#fff; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; vertical-align:middle; }
    th { background:#0f172a; color:#fff; }
    .blackX { color:black; font-weight:bold; }
    .redX { color:red; font-weight:bold; }
    .handle { cursor:grab; font-size:18px; text-align:center; }
    .order { text-align:center; font-weight:bold; }
    .btn-small { font-size:12px; padding:4px 6px; }
  </style>
</head>
<body>
  <h1>Reliable Superstore BDC Online Up List</h1>
  <div><span id="today"></span> • <span id="clock"></span></div>

  <div class="bar">
    <input id="nameInput" type="text" placeholder="Add team member name" />
    <button id="addBtn">Add</button>
    <button id="nextBtn">Next Lead (move X)</button>
    <button id="resetBtn">Reset</button>
    <button id="newDayBtn">New Day</button>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:44px">≡</th>
        <th>Order</th>
        <th>Name</th>
        <th>Status</th>
        <th>Up</th>
        <th>Leads</th>
        <th>Last Lead</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    // === CONFIG ===
    const SUPABASE_URL = "https://imfzlhudhljathvkgkqf.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const el = (id) => document.getElementById(id);
    const tbody = el('tbody');
    const nameInput = el('nameInput');

    // Time header
    function tick(){
      const d = new Date();
      el('today').textContent = d.toLocaleDateString(undefined,{ weekday:'long', year:'numeric', month:'long', day:'numeric' });
      el('clock').textContent = d.toLocaleTimeString();
    }
    setInterval(tick, 1000); tick();

    // --- CRUD ---
    async function fetchPeople(){
      const { data, error } = await supabase.from('people').select('*').order('order', { ascending:true });
      if(error) { console.error(error); return []; }
      return data;
    }

    async function addPerson(){
      const name = nameInput.value.trim();
      if(!name) return;
      const fixed = name.toLowerCase().replace(/\b\w/g, m => m.toUpperCase());
      await supabase.from('people').insert([{ name: fixed, status:"Here" }]);
      nameInput.value = "";
      loadPeople();
    }

    async function deletePerson(id){
      await supabase.from('people').delete().eq('id', id);
      loadPeople();
    }

    async function moveXHere(id){
      // clear all
      await supabase.from('people').update({ is_up: false }).neq('id', id);
      // set chosen
      await supabase.from('people').update({ is_up: true }).eq('id', id);
      loadPeople();
    }

    async function loadPeople(){
      const people = await fetchPeople();
      tbody.innerHTML = "";
      people.forEach((p,i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="handle">≡</td>
          <td class="order">${i+1}</td>
          <td>${p.name}</td>
          <td>${p.status}</td>
          <td>${p.is_up ? '<span class="blackX">X</span>' : (p.makeups>0? '<span class="redX">X</span>':'')}</td>
          <td>${p.leads||0}</td>
          <td>${p.last_served||''}</td>
          <td>
            <button class="btn-small" onclick="deletePerson('${p.id}')">X</button>
            <button class="btn-small" onclick="moveXHere('${p.id}')">Move X Here</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    // --- Events ---
    el('addBtn').onclick = addPerson;
    el('nextBtn').onclick = ()=>alert("TODO: Next Lead logic");
    el('resetBtn').onclick = ()=>alert("TODO: Reset logic");
    el('newDayBtn').onclick = ()=>alert("TODO: New Day logic");

    nameInput.addEventListener("keypress", (e)=>{
      if(e.key==="Enter"){ addPerson(); }
    });

    loadPeople();
  </script>
</body>
</html>
